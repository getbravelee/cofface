## 시스템 개요 및 핵심 목적

본 시스템은 오프라인 매장, 식음료 키오스크, 프랜차이즈 무인 시스템 등에서 사용자를 **얼굴로 인식**하여 회원 여부를 판별하고, **주문 이력 기반 추천**, **얼굴 기반 간편 결제**까지 제공하는 **End-to-End 얼굴인식 기반 통합 서비스**입니다.

### 주요 제공 기능

- 얼굴 기반 자동 로그인 및 회원 인증
- 등록된 결제수단을 통한 얼굴 간편 결제
- 최근 주문 내역, 성별/나이 기반 맞춤 메뉴 자동 추천
- 카메라 앞에 서는 것만으로도 모든 프로세스가 자동 진행됨

# 얼굴인식 기술 정리

## 1. 얼굴인식 개요

얼굴인식(Face Recognition)은 사람의 얼굴을 통해 신원을 식별하거나 인증하는 생체 인식 기술이다. 이 기술은 크게 아래와 같은 과정을 포함한다:

1. **Face Detection**: 얼굴의 위치 검출
2. **Face Alignment**: 랜드마크 기반 정렬
3. **Face Embedding**: 얼굴 특징 추출 (벡터화)
4. **Face Matching**: DB 내 얼굴 벡터와 유사도 비교
5. **Liveness Detection (Anti-Spoofing)**: 위조 여부 판별

---

## 2. 작동 방식 / 동작 원리

얼굴인식 시스템은 다양한 카메라 기술과 AI 알고리즘이 결합되어 작동하며, 기본적인 흐름은 다음과 같다:

1. **카메라 입력**: RGB / IR / Depth 카메라 등으로 얼굴 이미지 및 정보 수집
2. **얼굴 검출**: 영상 내 얼굴을 감지하고 얼굴의 위치(Bounding Box)를 추출
3. **정렬 및 전처리**: 랜드마크를 기반으로 얼굴 회전/크기 정규화
4. **특징 추출**: 얼굴 특징을 N차원 벡터로 임베딩 (CNN 기반)
5. **벡터 매칭**: 데이터베이스에 저장된 벡터와 유사도 비교
6. **라이브니스 확인**: 실제 사람인지 위조 이미지/영상인지 검증
7. **인증 결과**: 인증 성공 시 로그인/결제/추천 등 서비스 진행

---

## 3. 카메라 종류 및 기술별 분류

### ✅ RGB 카메라

- **설명**: 일반 컬러 카메라. 2D 이미지 캡처 전용.
- **동작 원리**: 가시광선을 기반으로 이미지 캡처
- **장점**: 비용 저렴, 설치 간편
- **단점**: 깊이 정보 없음, 조명/위조에 취약
- **사용 예**: 2D 얼굴인식, 스테레오 비전 (2대 사용 시)
- **관련 기술**: Face Detection, 2D → 3D 복원
- **주의사항**: 조명 조건과 노이즈에 민감함, Depth 미지원

---

### ✅ IR 카메라 (적외선)

- **설명**: 850~940nm 적외선 대역 촬영
- **동작 원리**: IR LED로 비춘 적외선을 감지해 촬영, 어두운 환경에서도 동작
- **장점**: 저조도 환경에서도 얼굴 감지 가능, 눈 깜빡임 탐지에 효과적
- **단점**: 단독 사용 시 거리 정보 없음, 컬러 정보 없음
- **사용 예**: 라이브니스 검증, 실내 보안 감시
- **관련 기술**: Anti-Spoofing, Passive Liveness

---

### ✅ Depth 카메라 (깊이 센서)

- **설명**: 카메라가 피사체와의 거리 정보를 각 픽셀 단위로 측정함
- **동작 원리**:
    - **스테레오 비전**: 두 개의 RGB 또는 IR 카메라를 일정 거리로 배치 → 시차(Disparity) 계산
    - **ToF (Time-of-Flight)**: IR 신호를 쏘고 반사되어 돌아오는 시간을 측정해 거리 계산
    - **Structured Light (SL)**: 수천 개의 패턴(dot grid)을 투사 후 왜곡 정도를 측정해 깊이 분석
- **장점**: 정확한 3D 얼굴 추출 가능, 위조 방지 기능 강화
- **단점**: 비용, 하드웨어 복잡도, 실외 노이즈에 취약
- **사용 예**: 키오스크, 보안 시스템, 제스처 인식 등

### Depth 카메라 (세부 방식 포함)

| 방식 | 원리 | 장점 | 단점 |
| --- | --- | --- | --- |
| **스테레오 비전** | RGB/IR 카메라 2대 간 시차 계산 | 저비용, 구현 쉬움 | 조도에 민감, 저정밀 |
| **ToF (Time-of-Flight)** | IR 신호 반사 시간 측정 | 빠름, 고정밀 | 고가, 실외에 약함 |
| **Structured Light (SL)** | 도트 패턴 투사 후 왜곡 분석 | 고정밀 3D 매핑 | 고가, 도트 프로젝터 필요 |

---

### ✅ IR 도트 프로젝터 - IR 카메라와 함께 사

- **설명**: 보이지 않는 적외선 dot 패턴을 얼굴에 투사해 3D 형상을 분석하는 구성요소
- **동작 원리**: 얼굴 위에 패턴을 투사하고 IR 카메라가 그 왜곡 정도를 측정 → 3D 맵 구성
- **장비 구성**: **항상 IR 카메라와 함께 사용**되어야 하며 단독 작동 불가
- **장점**: 구조광 방식으로 매우 정밀한 깊이 측정 가능
- **단점**: 가격이 높고, 전용 센서 탑재 필요
- **사용 예**: iPhone Face ID, 고보안 키오스크 인증

---

## 4. 얼굴 인식 방법별 구분

### ▶️ 1) 일반 2D RGB 카메라 두 대로 Depth 추정 (Stereo Vision)

- **기술**: 두 RGB 카메라의 시차(Disparity) 계산 → Depth Map 생성
- **장점**: 저렴, 구성 유연함, 기존 카메라 활용 가능
- **단점**: 조명, 텍스처 민감 / 정밀도 낮음
- **사용 예**: 토스 페이스페이, 일부 키오스크 솔루션

### ▶️ 2) Depth 카메라 직접 활용 (ToF / SL)

- **기술**: 장비 자체가 거리 계산을 해줌
- **장점**: 고정밀 3D 얼굴 추출, 위조 방지
- **단점**: 고가, 전력 소비↑, 실외 환경 민감

### ▶️ 3) 2D 이미지를 3D로 복원

- **기술**: AI로 2D 사진 → 3D Mesh 재구성 (DECA, PRNet 등)
- **장점**: 일반 카메라로도 고급 인식 가능
- **단점**: 복원 오류 가능성 / 학습 기반 모델 필요
- **사용 예**: 모바일 등록, 비대면 인증 등

## 얼굴인식 방식 비교

| 방식 | 설명 | 장점 | 단점 |
| --- | --- | --- | --- |
| RGB 2대 (Stereo Vision) | 시차 계산으로 Depth 추정 | 비용 저렴, 유연 | 조명 민감, 낮은 정밀도 |
| ToF / SL 기반 Depth 카메라 | 센서 자체가 거리 계산 | 고정밀, 위조 방지 우수 | 고가, 하드웨어 복잡 |
| 2D → 3D 변환 (DECA) | AI 기반 2D 이미지로 3D 복원 | 모바일 등록 가능 | 복원 정확도 모델에 의존 |

---

## 5. 얼굴 인식에 사용되는 AI 모델

| 모델 | 설명 |
| --- | --- |
| **InsightFace** | ArcFace 기반 SOTA 얼굴 인식 오픈소스, 정밀도 높음 |
| **ArcFace** | Cosine margin loss 기반 임베딩 생성 모델 |
| **FaceNet** | Google 개발, 얼굴 유사도 기반 인증 (L2 거리 기반) |
| **DECA** | 2D → 3D 얼굴 재구성 모델 (표정, 감정 포함 가능) |
| **MediaPipe** | 구글 제공, 얼굴 검출 및 랜드마크 추적에 유용 |

---

## 6. 보안 요소: 위조 방지 & 개인정보

### ✅ Liveness Detection (Anti-Spoofing)

- **Passive 방식**: 사용자의 움직임 없이 눈 깜빡임, 피부 결 분석 (IR 기반)
- **Active 방식**: 사용자의 행동 유도 (고개 좌우 회전, 표정 지어보기 등)
- **Depth 기반**: 얼굴의 실제 입체 정보와 표면의 깊이 분포를 분석 → 사진/영상/마스크 위조 차단

### ✅ 보안 고려사항

- 얼굴 데이터는 생체정보 → **암호화 저장(AES, hash)**
- **벡터 기반 저장** → 원본 복원 불가 구조 권장
- HTTPS + JWT 기반 전송, 인증 API 분리
- 동의서 확보 + 데이터 삭제/정정 권리 보장 (GDPR 등)

---

## 7. 얼굴 인식 시스템 활용 구조 예시

```
[카메라] → 얼굴 검출/정렬 (MTCNN 등) → 임베딩 추출 (ArcFace 등)
   ↓
[라이브니스 체크] (IR/Depth + 눈깜빡임)
   ↓
[서버 전송] → 벡터 DB 검색 (Faiss, Milvus)
   ↓
[사용자 인증] → 로그인 / 결제 / 맞춤 추천
```

---

## 8. 결론 및 추천 구성

| 목적 | 추천 카메라 | 추천 기술 |
| --- | --- | --- |
| MVP/프로토타입 | 2D 스테레오 (RGB 2대) | OpenCV Stereo + ArcFace |
| 상용화 키오스크 | Structured Light or ToF Depth 카메라 | InsightFace + Liveness + SL |
| 모바일 등록용 | 2D 이미지 + DECA 3D 복원 | DECA + Vector DB 매칭 |

## 9. 시스템 전체 흐름도 및 처리 단계

```bash
[1] 사용자 키오스크 접근
 ↓
[2] RGB/IR/Depth 카메라로 얼굴 영상 수집
 ↓
[3] 얼굴 검출 (Face Detection)
 ↓
[4] 랜드마크 기반 정렬 (Alignment)
 ↓
[5] 얼굴 임베딩 추출 (512D 벡터 생성)
 ↓
[6] 라이브니스 검증 (깜빡임, Depth, 움직임 분석)
 ↓
[7] 유사도 기반 벡터 DB 검색 (Top-1 Matching)
 ↓
[8] 사용자 인증 성공 → 사용자 ID 획득
 ↓
[9] 최근 주문/선호 메뉴 분석 → 자동 추천 UI 구성
 ↓
[10] 결제 수단 연동 → 사용자 얼굴만으로 결제 승인
```

## 10. 구축 우선순위 및 기술 전략

| 단계 | 기술 요소 | 목표 |
| --- | --- | --- |
| 1단계 (MVP) | RGB 2대 + OpenCV Stereo + ArcFace + Faiss | 프로토타입으로 사용자 인증 가능 여부 검증 |
| 2단계 (정식 상용) | Structured Light Depth + InsightFace + Liveness + Milvus | 고정밀 상용 제품화, 대규모 서비스 대응 |
| 3단계 (모바일 연동) | 2D 얼굴 등록 + DECA 기반 3D 복원 + 클라우드 연동 | 앱 기반 사용자 선등록 구조 구성 |
